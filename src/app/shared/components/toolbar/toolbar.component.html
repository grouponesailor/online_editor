<!-- Toolbar -->
<div class="bg-white border-b">
  <!-- Tabs -->
  <div class="flex border-b">
    <button
      *ngFor="let tab of tabs"
      class="px-4 py-2 flex items-center gap-2 text-sm font-medium hover:text-[#6200EE] transition-colors"
      [class.text-blue-600]="currentTab === tab.id"
      [class.border-b-2]="currentTab === tab.id"
      [class.border-blue-600]="currentTab === tab.id"
      (click)="currentTab = tab.id">
      <i [class]="tab.icon"></i>
      {{ tab.label }}
    </button>
  </div>

  <!-- File Tab -->
  <div *ngIf="currentTab === 'file'">
    <app-file-toolbar
      [documentId]="documentId"
      [documentName]="getCurrentDocumentName()"
      (newDocument)="onNewDocument()"
      (openDocument)="onOpenDocument()"
      (saveDocument)="onSaveDocument()"
      (exportDocument)="onExportPDF()">
    </app-file-toolbar>
  </div>

  <!-- Home Tab -->
  <div *ngIf="currentTab === 'home'" class="flex flex-wrap gap-1 p-1">
    <!-- Clipboard -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100"
        (click)="handleUndo()"
        [disabled]="!canUndo()"
        title="Undo">
        <i class="fas fa-undo"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100"
        (click)="handleRedo()"
        [disabled]="!canRedo()"
        title="Redo">
        <i class="fas fa-redo"></i>
      </button>
    </div>

    <!-- Share Button -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100"
        (click)="toggleShareDialog()"
        title="Share Document">
        <i class="fas fa-share-alt"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100"
        (click)="toggleComments()"
        title="Toggle Comments">
        <i class="fas fa-comments"></i>
      </button>
    </div>

    <!-- Headings -->
    <div class="flex gap-1 border-r pr-2">
      <div class="relative">
        <button
          class="p-2 rounded hover:bg-gray-100 flex items-center min-w-[120px] justify-between text-sm"
          (click)="showHeadingMenu = !showHeadingMenu"
          title="Select Heading Level">
          <span>{{ getCurrentHeadingLabel() }}</span>
          <i class="fas fa-chevron-down ml-1 text-xs"></i>
        </button>
        <div *ngIf="showHeadingMenu" class="absolute top-full left-0 mt-1 bg-white shadow-lg rounded py-1 z-50 w-56 heading-dropdown">
          <button
            *ngFor="let heading of headingItems"
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 text-sm flex justify-between items-center"
            [class.bg-blue-50]="heading.value === currentHeading"
            [class.font-semibold]="heading.value === currentHeading"
            [attr.data-heading]="heading.value"
            (click)="setHeading(heading.value)">
            <span>{{ heading.label }}</span>
            <span class="text-xs text-gray-400">{{ heading.shortcut }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Font -->
    <div class="flex gap-1 border-r pr-2">
      <select
        class="rounded border px-2"
        (change)="setFontFamily($event)"
        [value]="currentFontFamily">
        <option *ngFor="let font of fontFamilies" [value]="font.value">
          {{ font.label }}
        </option>
      </select>
      <select
        class="rounded border px-2 w-20"
        (change)="setFontSize($event)"
        [value]="currentFontSize">
        <option *ngFor="let size of fontSizes" [value]="size.value">
          {{ size.label }}
        </option>
      </select>
    </div>

    <!-- Text Formatting -->
    <div class="flex gap-1 border-r pr-2">
      <button
        *ngFor="let item of textFormatItems"
        class="p-2 rounded hover:bg-gray-100"
        [class.bg-gray-200]="editor?.isActive(item.type)"
        (click)="item.command(editor)"
        [title]="item.label">
        <i [class]="item.icon"></i>
      </button>
    </div>

    <!-- Text & Highlight Color -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="toolbar-color-btn p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors flex items-center relative"
        [class.active]="showTextColorPicker"
        (click)="toggleTextColor()"
        data-color-trigger
        title="Text Color">
        <div class="color-icon-container">
          <i class="fas fa-font text-gray-700"></i>
          <div 
            class="color-swatch"
            [class.light-color]="currentTextColor === '#FFFFFF' || currentTextColor === '#FFFF00' || currentTextColor === '#00FFFF'"
            [style.background-color]="currentTextColor">
          </div>
        </div>
        <i class="fas fa-chevron-down ml-1 text-xs"></i>
      </button>
      <button
        class="toolbar-color-btn p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors flex items-center relative"
        [class.active]="showHighlightPicker"
        (click)="toggleHighlight()"
        data-color-trigger
        title="Highlight">
        <div class="color-icon-container">
          <i class="fas fa-highlighter text-gray-700"></i>
          <div 
            class="color-swatch"
            [class.light-color]="currentHighlightColor === '#FFFFFF' || currentHighlightColor === '#FFFF00' || currentHighlightColor === '#FFFACD' || currentHighlightColor === '#D3D3D3'"
            [style.background-color]="currentHighlightColor">
          </div>
        </div>
        <i class="fas fa-chevron-down ml-1 text-xs"></i>
      </button>
    </div>

    <!-- Lists -->
    <div class="flex gap-1 border-r pr-2">
      <div class="relative">
        <button
          class="p-2 rounded hover:bg-gray-100 flex items-center"
          (click)="showListMenu = !showListMenu"
          title="List Options">
          <i class="fas fa-list"></i>
          <i class="fas fa-chevron-down ml-1 text-xs"></i>
        </button>
        <div *ngIf="showListMenu" class="absolute top-full left-0 mt-1 bg-white shadow-lg rounded py-1 z-50 w-64">
          <button
            *ngFor="let listItem of listItems"
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 text-sm flex items-center gap-3"
            [class.bg-blue-50]="editor?.isActive(listItem.value.includes('bullet') ? 'bulletList' : listItem.value.includes('ordered') ? 'orderedList' : 'taskList')"
            (click)="listItem.command(editor); showListMenu = false">
            <i [class]="listItem.icon" class="text-gray-600 w-4"></i>
            <span>{{ listItem.label }}</span>
          </button>
        </div>
      </div>
      
      <!-- Quick list buttons -->
      <button
        class="p-2 rounded hover:bg-gray-100"
        [class.bg-gray-200]="editor?.isActive('bulletList')"
        (click)="toggleBulletList()"
        title="Bullet List">
        <i class="fas fa-list-ul"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100"
        [class.bg-gray-200]="editor?.isActive('orderedList')"
        (click)="toggleOrderedList()"
        title="Numbered List">
        <i class="fas fa-list-ol"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100"
        [class.bg-gray-200]="editor?.isActive('taskList')"
        (click)="toggleTaskList()"
        title="Task List">
        <i class="fas fa-tasks"></i>
      </button>
    </div>

    <!-- Alignment -->
    <div class="flex gap-1 border-r pr-2">
      <button
        *ngFor="let item of alignmentItems"
        class="p-2 rounded hover:bg-gray-100"
        [class.bg-gray-200]="editor?.isActive({ textAlign: item.align })"
        (click)="item.command(editor)"
        [title]="item.label">
        <i [class]="item.icon"></i>
      </button>
    </div>
  </div>

  <!-- Insert Tab -->
  <div *ngIf="currentTab === 'insert'" class="flex flex-wrap gap-1 p-1">
    <!-- Table -->
    <div class="flex gap-1 border-r pr-2">
      <div class="relative">
        <button
          class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors flex items-center"
          (click)="showTableMenu = !showTableMenu"
          title="Insert Table">
          <i class="fas fa-table"></i>
          <i class="fas fa-chevron-down ml-1"></i>
        </button>
        <div *ngIf="showTableMenu" class="absolute top-full left-0 mt-1 z-50 table-grid-preview">
          <div class="grid">
            <button
              *ngFor="let cell of tableGrid"
              class="cell"
              [class.selected]="cell.selected"
              (mouseover)="updateTableSelection(cell.row, cell.col)"
              (click)="insertTable(cell.row, cell.col)">
            </button>
          </div>
          <div class="dimensions">
            {{ tableSelection.row }} Ã— {{ tableSelection.col }} Table
          </div>
        </div>
      </div>
    </div>

    <!-- Image -->
    <div class="flex gap-1 border-r pr-2">
      <div class="relative">
        <button
          class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors flex items-center"
          (click)="showImageMenu = !showImageMenu"
          title="Insert Image">
          <i class="fas fa-image"></i>
          <i class="fas fa-chevron-down ml-1"></i>
        </button>
        <div *ngIf="showImageMenu" class="absolute top-full left-0 mt-1 bg-white shadow-lg rounded py-1 z-50 w-48">
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="uploadImage()">
            <i class="fas fa-upload mr-2"></i> Upload from computer
          </button>
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="insertImageByUrl()">
            <i class="fas fa-link mr-2"></i> By URL
          </button>
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="searchImage()">
            <i class="fas fa-search mr-2"></i> Search the web
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shapes Tab -->
  <div *ngIf="currentTab === 'shapes'" class="p-1">
    <div class="grid grid-cols-8 gap-2">
      <button
        *ngFor="let shape of shapes"
        class="p-2 border rounded hover:bg-gray-100 hover:border-[#6200EE] hover:text-[#6200EE] transition-colors shape-preview"
        (click)="insertShape(shape)"
        [title]="shape.name">
        <div class="w-8 h-8" [innerHTML]="sanitizeHTML(shape.svgPath)"></div>
      </button>
    </div>
  </div>

  <!-- Format Tab -->
  <div *ngIf="currentTab === 'format'" class="flex flex-wrap gap-1 p-1">
    <!-- Spacing -->
    <div class="flex gap-1 border-r pr-2">
      <div class="relative">
        <button
          class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors flex items-center"
          (click)="showLineSpacingMenu = !showLineSpacingMenu"
          title="Line Spacing">
          <i class="fas fa-align-justify"></i>
          <i class="fas fa-chevron-down ml-1"></i>
        </button>
        <div *ngIf="showLineSpacingMenu" class="absolute top-full left-0 mt-1 bg-white shadow-lg rounded py-1 z-50 w-32">
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="setLineHeight('1.0')">
            1.0
          </button>
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="setLineHeight('1.5')">
            1.5
          </button>
          <button
            class="block w-full px-4 py-2 text-left hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
            (click)="setLineHeight('2.0')">
            2.0
          </button>
        </div>
      </div>
    </div>

    <!-- Tools -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        [class.bg-gray-200]="formatPainterActive"
        (click)="toggleFormatPainter()"
        title="Format Painter">
        <i class="fas fa-paint-brush"></i>
      </button>
    </div>

    <!-- Zoom -->
    <div class="flex gap-1 pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        (click)="zoomOut()"
        title="Zoom Out">
        <i class="fas fa-search-minus"></i>
      </button>
      <span class="flex items-center px-2 text-sm">
        {{ (currentZoom * 100) | number:'1.0-0' }}%
      </span>
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        (click)="zoomIn()"
        title="Zoom In">
        <i class="fas fa-search-plus"></i>
      </button>
    </div>
  </div>

  <!-- View Tab -->
  <div *ngIf="currentTab === 'view'" class="flex flex-wrap gap-1 p-1">
    <!-- Layout -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        title="Print Layout">
        <i class="fas fa-file-alt"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        title="Web Layout">
        <i class="fas fa-globe"></i>
      </button>
    </div>

    <!-- Show -->
    <div class="flex gap-1 border-r pr-2">
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        title="Ruler">
        <i class="fas fa-ruler-horizontal"></i>
      </button>
      <button
        class="p-2 rounded hover:bg-gray-100 hover:text-[#6200EE] transition-colors"
        title="Gridlines">
        <i class="fas fa-th"></i>
      </button>
    </div>
  </div>
</div>

<!-- Text Color Picker -->
<div *ngIf="showTextColorPicker" class="fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Text Color</h3>
      <button 
        class="text-gray-400 hover:text-gray-600"
        (click)="showTextColorPicker = false">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Common Colors Grid -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Common Colors</label>
      <div class="grid grid-cols-8 gap-2">
        <button
          *ngFor="let color of commonTextColors"
          class="w-8 h-8 rounded border-2 hover:border-gray-400 transition-colors"
          [style.background-color]="color"
          [class.border-blue-500]="currentTextColor === color"
          [class.border-gray-400]="currentTextColor !== color && (color === '#FFFFFF' || color === '#FFFF00' || color === '#00FFFF' || color === '#FF00FF')"
          [class.border-gray-300]="currentTextColor !== color && !(color === '#FFFFFF' || color === '#FFFF00' || color === '#00FFFF' || color === '#FF00FF')"
          (click)="selectTextColor(color)"
          [title]="color">
        </button>
      </div>
    </div>

    <!-- Custom Color -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Custom Color</label>
      <div class="flex items-center gap-3">
        <input
          type="color"
          [(ngModel)]="currentTextColor"
          class="w-12 h-8 rounded border border-gray-300 cursor-pointer">
        <span class="text-sm text-gray-600">{{ currentTextColor }}</span>
      </div>
    </div>

    <!-- Remove Text Color Option -->
    <div class="mb-4">
      <button
        class="w-full px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded hover:bg-red-100 transition-colors"
        (click)="removeTextColor()">
        <i class="fas fa-eraser mr-2"></i>
        Remove Text Color
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 pt-4 border-t">
      <button 
        class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors" 
        (click)="showTextColorPicker = false">
        Cancel
      </button>
      <button 
        class="flex-1 px-4 py-2 bg-[#6200EE] text-white rounded hover:bg-[#5000CC] transition-colors" 
        (click)="applyTextColor()">
        Apply
      </button>
    </div>
  </div>
</div>

<!-- Highlight Color Picker -->
<div *ngIf="showHighlightPicker" class="fixed inset-0 bg-black bg-opacity-25 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">Highlight Color</h3>
      <button 
        class="text-gray-400 hover:text-gray-600"
        (click)="showHighlightPicker = false">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Common Colors Grid -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Common Highlight Colors</label>
      <div class="grid grid-cols-8 gap-2">
        <button
          *ngFor="let color of commonHighlightColors"
          class="w-8 h-8 rounded border-2 hover:border-gray-400 transition-colors"
          [style.background-color]="color"
          [class.border-blue-500]="currentHighlightColor === color"
          [class.border-gray-400]="currentHighlightColor !== color && (color === '#FFFF00' || color === '#00FFFF' || color === '#FF00FF' || color === '#FFFACD' || color === '#D3D3D3')"
          [class.border-gray-300]="currentHighlightColor !== color && !(color === '#FFFF00' || color === '#00FFFF' || color === '#FF00FF' || color === '#FFFACD' || color === '#D3D3D3')"
          (click)="selectHighlightColor(color)"
          [title]="color">
        </button>
      </div>
    </div>

    <!-- Custom Color -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Custom Color</label>
      <div class="flex items-center gap-3">
        <input
          type="color"
          [(ngModel)]="currentHighlightColor"
          class="w-12 h-8 rounded border border-gray-300 cursor-pointer">
        <span class="text-sm text-gray-600">{{ currentHighlightColor }}</span>
      </div>
    </div>

    <!-- Remove Highlight Option -->
    <div class="mb-4">
      <button
        class="w-full px-4 py-2 bg-red-50 text-red-600 border border-red-200 rounded hover:bg-red-100 transition-colors"
        (click)="removeHighlight()">
        <i class="fas fa-eraser mr-2"></i>
        Remove Highlight
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3 pt-4 border-t">
      <button 
        class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors" 
        (click)="showHighlightPicker = false">
        Cancel
      </button>
      <button 
        class="flex-1 px-4 py-2 bg-[#6200EE] text-white rounded hover:bg-[#5000CC] transition-colors" 
        (click)="applyHighlight()">
        Apply
      </button>
    </div>
  </div>
</div>

<!-- Image Edit Dialog -->
<app-image-edit-dialog
  *ngIf="showImageEditDialog && selectedImage"
  [selectedImage]="selectedImage"
  (save)="updateImage($event)"
  (cancel)="showImageEditDialog = false">
</app-image-edit-dialog>

<!-- Editor Component -->
<app-editor
  [documentId]="documentId"
  (contentChange)="onEditorContentChange($event)">
</app-editor>

<!-- Metadata Toolbar -->
<div class="fixed bottom-0 left-0 right-0 bg-white border-t px-4 py-2 flex items-center justify-between text-sm text-gray-600">
  <!-- Left side stats -->
  <div class="flex items-center gap-6">
    <div class="flex items-center gap-2 min-w-[100px]">
      <i class="fas fa-file-alt"></i>
      <span>{{ wordCount }} words</span>
    </div>
    <div class="flex items-center gap-2 min-w-[100px]">
      <i class="fas fa-clock"></i>
      <span>{{ readingTime }} min read</span>
    </div>
    <div class="flex items-center gap-2 min-w-[120px]">
      <i class="fas fa-paragraph"></i>
      <span>{{ paragraphCount }} paragraphs</span>
    </div>
    <div class="flex items-center gap-2 min-w-[120px]">
      <i class="fas fa-font"></i>
      <span>{{ characterCount }} characters</span>
    </div>
  </div>

  <!-- Right side stats -->
  <div class="flex items-center gap-6">
    <div class="flex items-center gap-2 min-w-[120px]">
      <span>Page {{ currentPage }} of {{ pages.length }}</span>
    </div>
    <div class="flex items-center gap-2">
      <button 
        class="hover:text-[#6200EE] transition-colors p-1"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        title="Previous Page">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button 
        class="hover:text-[#6200EE] transition-colors p-1"
        (click)="nextPage()"
        [disabled]="currentPage === pages.length"
        title="Next Page">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <div class="flex items-center gap-2 min-w-[100px]">
      <span>{{ currentZoom * 100 | number:'1.0-0' }}%</span>
      <button 
        class="hover:text-[#6200EE] transition-colors p-1"
        (click)="zoomOut()"
        title="Zoom Out">
        <i class="fas fa-search-minus"></i>
      </button>
      <button 
        class="hover:text-[#6200EE] transition-colors p-1"
        (click)="zoomIn()"
        title="Zoom In">
        <i class="fas fa-search-plus"></i>
      </button>
    </div>
  </div>
</div>